# Конфигурация

## Встраивание в форму

Интеграция виджета происходит следующим образом:

```html
<?php $form = ActiveForm::begin([
    'fieldClass' => ActiveField::class, // Обязательно переопределение класса поля, так как стандартный класс не умеет работать с ошибками во вложенных сущностях 
]) ?>

<?= $form->field($myModel, 'my_field', ['options' => ['id' => 'myMyltipleField']])->widget(MultipleField::class, [
    'options' => [
        'tag' => 'div',
    ],
    'itemOptions' => [
        'tag' => 'div',
        'class' => 'my-item',
    ],
    'item' => '_item',
    'params' => [
        'myCustomParam' => 'myCustomParamValue',
    ],
]) ?>

<?php ActiveForm::end() ?>
```

Теперь по порядку, по полям:

* **options** - Свойства виджета MultipleForm.
* **itemOptions** - Свойства блока.
* **item** - Название шаблона или callback-функция, производящая рендер блока.
* **params** - Дополнительные параметры, передаваемые в шаблон.

### Шаблон блока

Шаблон блока представляет собой стандартный шаблон View в котором доступны две локальные переменные:

* **$block** - Экземпляр MultipleField реализующий рендер текущего блока.
* **$key** - Текущий отображаемый индекс.
* **?** - Любые иные параметры переданные в MultipleField класс в поле params при инициализации.

Вставка полей ввода в блоках происходит не от формы, а от самого блока, но в том же самом синтаксисе:

```php
$block->field('my_sub_field')->textInput();
```

Отличием является то, что метод field() блока не требует указания исходной модели данных, так как она уже была ранее указана для самого
MultipleField. Так же стоит отметить, что поле my_sub_field является вложенным полем в массив полей my_field указанным
как поле формы в конфигурации встраивания в форму.

Метод field() возвращает привычный ActiveField, через который может быть реализована вся полнота полей ввода или иных
виджетов для вложенных полей.

## Управление через javascript

MultipleField предоставляет следующие методы управления блоками полей ввода.

* **add**() - Добавляет новый пустой блок.
* **remove**(indexOrElement) - Удаляет указанный блок по его номеру или html-элементу в нём.
* **count**() - Возвращает текущее количество блоков.
* **index**(element) - Возвращает индекс текущего блока по html-элементу.
* **option**(name, [value]) - Чтение или запись параметра виджета.

Для вызова метода достаточно обратиться к объекту multipleField по его id:

```javascript
$('#myMyltipleField').multipleField('remove', 4);
```

```html
<button onclick="$('#myMyltipleField').multipleField('remove', this)">Delete</button>
```

### События

* **afterInit** - Событие, вызываемое по факту инициализации виджета.
* **beforeAdd** - Событие, предшествующее добавлению нового блока. Если обработчик события вернет false, то добавление
блока произведено не будет.
* **afterAdd** - Событие, вызываемое после добавления нового блока.
* **beforeRemove** - Событие, предшествующее удалению блока. Если обработчик события вернет false, то удаление блока
произведено не будет.
* **afterRemove** - Событие, вызываемое после удаления блока.

## Валидация на стороне бекенда

```php
public function rules(): array
{
    return [
        [['my_field'], 'required'],
        [['my_field'], KeyArrayValidator::class, [
            [['my_sub_field'], 'string', 'max' => 255],        
        ]],
    ];
}
```
