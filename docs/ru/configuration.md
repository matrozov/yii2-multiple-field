# Конфигурация

## Встраивание в форму

Интеграция виджета происходит следующим образом:

```php
$form->field($myModel, 'my-field')->widget(MultipleField::class, [
    'options' => [
        'tag' => 'div',
    ],
    'itemOptions' => [
        'tag' => 'div',
        'class' => 'my-item',
    ],
    'item' => '_item',
    'max' => 10,
    'maxReachedMessage' => 'Item limit :(',
]);
```

Теперь по порядку, по полям:

* **options** - Свойства виджета MultipleForm.
* **itemOptions** - Свойства блока.
* **item** - Название шаблона или callback-функция, производящая рендер блока.
* **max** - Максимальное количество блоков (по умолчанию = null, без лимита).
* **maxReachedMessage** - Сообщение, выводимое при помощи функции js Alert при достижении лимита блоков, если была
вызвана функция добавления нового блока.

### Шаблон блока

Шаблон блока представляет из себя стандартный шаблон View в котором доступны две локальные переменные:

* **$block** - Экземпляр MultipleField реализующий рендер текущего блока.
* **$key** - Текущий отображаемый индекс.

Вставка полей ввода в блоках происходит не от формы, а от самого блока но, почти, в том же самом синтаксисе:

```php
$block->field('my-sub-field')->textInput();
```

Отличием является то, что метод field() блока не требует указания исходной модели данных, так как она уже была ранее указана для самого
MultipleField. Так же стоит отметить, что поле my-sub-field явдяется вложенным полем в массив полей my-field указанным
как поле формы в конфигурации встраивания в форму.

Метод field() возвращает привычный ActiveField, через который может быть реализована вся полнота полей ввода или иных
виджетов для вложенных полей.

## Управление через javascript

MultipleField предоставляет следующие методы управления блоками полей ввода.

* **add**() - Добавляет новый пустой блок.
* **remove**(index) - Удаляет указанный по счету блок.
* **count**() - Возвращает текущее количество блоков.
* **option**(name, [value]) - Чтение или запись параметра виджета.

Для вызова метода достаточно обратиться к объекту multipleField по его id:

```javascript
$("#myMyltipleField").multipleField('remove', 4);
```

### События

* **afterInit** - Событие, вызываемое по факту инициализации виджета.
* **beforeAdd** - Событие, предшествующее добавлению нового блока. Если обработчик события вернет false, то добавление
блока произведено не будет.
* **afterAdd** - Событие, вызываемое после добавления нового блока.
* **beforeRemove** - Событие, предшествующее удалению блока. Если обработчик события вернет false, то удаление блока
произведено не будет.
* **afterRemove** - Событие, вызываемое после удаления блока.
* **maxReached** - Событие, происходящее при попытке добавления блока сверх лимита. Если обработчик события вернет false,
то стандартное сообщение по средством метода Alert вызвано не будет. Данное поведение используется для переопределения
отображения сообщения об ошибки достижения лимита.

### Предопределенные действия

MultipleField предоставляет предопределенные действия, вызываемые из шаблона блока. Если в шаблоне разместить кликабельный
элемент со следующим классом, то он будут производить соответствующее названию действие:

* **js-item-add** - Добавление нового блока в конец списка.
* **js-item-remove** - Удаление текущего блока.

Стоит учесть, что кнопки добавления и удаления автоматически скрываются или показываются исходя из следующей логики:
Только у первого элемента есть кнопка добавления новых блоков. У всех элементов, кроме первого, есть кнопка удаления
текущего блока.